"use strict";(self.webpackChunkionio_website=self.webpackChunkionio_website||[]).push([[555],{3905:function(t,e,n){n.d(e,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function o(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?o(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function l(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},o=Object.keys(t);for(a=0;a<o.length;a++)n=o[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(a=0;a<o.length;a++)n=o[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var s=a.createContext({}),c=function(t){var e=a.useContext(s),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},p=function(t){var e=c(t.components);return a.createElement(s.Provider,{value:e},t.children)},u={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},d=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,o=t.originalType,s=t.parentName,p=l(t,["components","mdxType","originalType","parentName"]),d=c(n),m=r,k=d["".concat(s,".").concat(m)]||d[m]||u[m]||o;return n?a.createElement(k,i(i({ref:e},p),{},{components:n})):a.createElement(k,i({ref:e},p))}));function m(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in e)hasOwnProperty.call(e,s)&&(l[s]=e[s]);l.originalType=t,l.mdxType="string"==typeof t?t:r,i[1]=l;for(var c=2;c<o;c++)i[c]=n[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6188:function(t,e,n){n.r(e),n.d(e,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},assets:function(){return p},toc:function(){return u},default:function(){return m}});var a=n(7462),r=n(3366),o=(n(7294),n(3905)),i=["components"],l={title:"Build your first Liquid smart contract with Ionio SDK",description:"Build a calculator smart contract with Elements Tapscript to be deployed on the Liquid Network",slug:"ionio-calculator",authors:[{name:"Marco Argentieri",title:"Ionio contributor",url:"https://github.com/tiero",image_url:"https://github.com/tiero.png"}],tags:["ionio","sdk","tutorial","smart contract","workshop","liquid network"],hide_table_of_contents:!1},s=void 0,c={permalink:"/blog/ionio-calculator",source:"@site/blog/2022-09-01-ionio-calculator.md",title:"Build your first Liquid smart contract with Ionio SDK",description:"Build a calculator smart contract with Elements Tapscript to be deployed on the Liquid Network",date:"2022-09-01T00:00:00.000Z",formattedDate:"September 1, 2022",tags:[{label:"ionio",permalink:"/blog/tags/ionio"},{label:"sdk",permalink:"/blog/tags/sdk"},{label:"tutorial",permalink:"/blog/tags/tutorial"},{label:"smart contract",permalink:"/blog/tags/smart-contract"},{label:"workshop",permalink:"/blog/tags/workshop"},{label:"liquid network",permalink:"/blog/tags/liquid-network"}],readingTime:3.83,truncated:!0,authors:[{name:"Marco Argentieri",title:"Ionio contributor",url:"https://github.com/tiero",image_url:"https://github.com/tiero.png",imageURL:"https://github.com/tiero.png"}]},p={authorsImageUrls:[void 0]},u=[{value:"Context",id:"context",children:[],level:2},{value:"Dev Environment",id:"dev-environment",children:[{value:"Nigiri",id:"nigiri",children:[],level:3},{value:"Install dependencies &amp; config",id:"install-dependencies--config",children:[],level:3},{value:"Add Layout and state",id:"add-layout-and-state",children:[],level:3},{value:"\ud83d\udcb0 Fund",id:"-fund",children:[],level:3},{value:"\ud83d\udcb8 Spend",id:"-spend",children:[],level:3}],level:2}],d={toc:u};function m(t){var e=t.components,n=(0,r.Z)(t,i);return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:e,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"You got your faboulos script with all those cute opcodes, and now what? ",(0,o.kt)("strong",{parentName:"p"},"Ionio SDK FTW!")),(0,o.kt)("h2",{id:"context"},"Context"),(0,o.kt)("p",null,"In the Bitcoin world, most of the possible scripts are ",(0,o.kt)("em",{parentName:"p"},"de-facto")," standards all wallets follow, set in stone by the wallet developer."),(0,o.kt)("p",null,"In a ",(0,o.kt)("strong",{parentName:"p"},"post-Simplicty")," world, Bitcoin (tap)scripts will introduce much more capabilities, but\nstadardize all possible combination in all wallets becomes impossibile, will be the user (or any external app he's interacting with) to instruct the wallet what to do at runtime."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Output Descriptors")," and ",(0,o.kt)("strong",{parentName:"p"},"Miniscript")," could be a good candidate on how to generalize a way to import script, but i) lack of extensibility in cooperative script building scenarios ii) need to write a parser/compiler for each language makes it a bit ",(0,o.kt)("a",{parentName:"p",href:"/docs/Artifact#alternatives"},"cumbersome for wallet/libraries to work with"),', plus the "policy oriented" nature does not well fit the introspection (ie. covenants) paradigm Simplicity will allow.'),(0,o.kt)("p",null,"The feature to import a ",(0,o.kt)("strong",{parentName:"p"},"script template")," is fundamental for the wallet to ",(0,o.kt)("strong",{parentName:"p"},"track balances")," and to know ",(0,o.kt)("strong",{parentName:"p"},"how spend")," those coins in the future."),(0,o.kt)("p",null,"The ",(0,o.kt)("strong",{parentName:"p"},"Ionio Artifact")," it's a JSON file that fully describe how a ",(0,o.kt)("strong",{parentName:"p"},"Pay to Taproot")," address is constructed, how the contract behaves and what it should be expected to do spend it in the future. The documentation fot the data structure can be found ",(0,o.kt)("a",{parentName:"p",href:"/docs/Artifact#structure"},"here")),(0,o.kt)("h1",{id:"-you-first-calculator"},'\ud83e\uddee You first "calculator"'),(0,o.kt)("h2",{id:"dev-environment"},"Dev Environment"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/desktop/linux/install"},"Docker Linux")," or ",(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/desktop/mac/install"},"Docker Desktop for Mac")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://nigiri.vulpem.com"},"Nigiri")),(0,o.kt)("li",{parentName:"ul"},"nodejs"),(0,o.kt)("li",{parentName:"ul"},"yarn (optional, you can use npm)")),(0,o.kt)("h3",{id:"nigiri"},"Nigiri"),(0,o.kt)("p",null,"Install Nigiri"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"curl https://getnigiri.vulpem.com | bash\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Run a Liquid box")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"nigiri start --liquid\n")),(0,o.kt)("h3",{id:"install-dependencies--config"},"Install dependencies & config"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Project setup")),(0,o.kt)("p",null,"Pull a Svelte starter app"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},'npx degit "tiero/svelte-webpack-bulma" ionio-app\n')),(0,o.kt)("p",null,"Enter the folder "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd ionio-app\n")),(0,o.kt)("p",null,"Install depenendencies "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"yarn add @ionio-lang/ionio tiny-secp256k1\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Create a ",(0,o.kt)("inlineCode",{parentName:"li"},"calculator.json")," file in ",(0,o.kt)("inlineCode",{parentName:"li"},"src"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "contractName": "Calculator",\n  "constructorInputs": [\n    {\n      "name": "sum",\n      "type": "number"\n    }\n  ],\n  "functions": [\n    {\n      "name": "sumMustBeThree",\n      "functionInputs": [\n        {\n          "name": "a",\n          "type": "number"\n        },\n        {\n          "name": "b",\n          "type": "number"\n        }\n      ],\n      "require": [],\n      "asm": [\n        "OP_ADD",\n        "$sum",\n        "OP_EQUAL"\n      ]\n    }\n  ]\n}\n')),(0,o.kt)("h3",{id:"add-layout-and-state"},"Add Layout and state"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Open ",(0,o.kt)("inlineCode",{parentName:"p"},"App.svelte")," in your editor")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add layout after the title box "))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<div class="box">\n  <h1 class="title">Calculator</h1>\n  <p class="has-text-weight-bold">\n    {contractAddress}\n  </p>\n  <hr />\n\n  {#if txhex.length > 0} \n    <hr />\n    <p class="subtitle">Raw transaction</p>\n    <input class="input" value={txhex} />\n  {/if}\n</div>\n')),(0,o.kt)("ol",{start:4},(0,o.kt)("li",{parentName:"ol"},"Add script section on top")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"<script type=\"ts\">\n  import { Artifact, Contract } from '@ionio-lang/ionio';\n  import { networks, address, ElementsValue, AssetHash } from 'liquidjs-lib';\n  import * as ecc from 'tiny-secp256k1';\n  import artifact from './calculator.json';\n\n  // instantiate the secp256-zkp wasm library\n  // define the network we going to work\n  const network = networks.regtest;\n  // create empty state\n  let txhex = '';\n  // amounts to use for spending\n  const sats = 100000;\n  const fee = 100;\n\n  // \ud83d\udcda Let's compile the script\n  const contract = new Contract(\n    // our JSON artifact file\n    artifact as Artifact,\n    // our constructor to replace template strings\n    [3],\n    // network for address encoding\n    network,\n    // injectable secp256k1 libraries\n    { ecc, zkp: null }\n  );\n  const contractAddress = contract.address;\n<\/script>\n")),(0,o.kt)("h3",{id:"-fund"},"\ud83d\udcb0 Fund"),(0,o.kt)("p",null,"Run the app with ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn dev")," to see the address for your calculator"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# send 100k sats to the contract\n# this will auto-mine a block\nnigiri faucet --liquid <contract_address> 0.001\n")),(0,o.kt)("p",null,"You can open the exploer at ",(0,o.kt)("inlineCode",{parentName:"p"},"http://localhost:5001")," and copy/paste address to check utxos"),(0,o.kt)("p",null,"Track down the ",(0,o.kt)("inlineCode",{parentName:"p"},"txid")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"vout")," of the new unspent output that locks coin in the calculator"),(0,o.kt)("h3",{id:"-spend"},"\ud83d\udcb8 Spend"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Add a ",(0,o.kt)("inlineCode",{parentName:"li"},"onClick")," function to be triggered by button")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"  const onClick = async () => {\n    const txid = prompt('Enter a transaction hash');\n    const vout = prompt('Enter the vout');\n\n    // attach to the funded contract using the utxo\n    const instance = contract.from(\n      // tranaction ID\n      txid,\n      // previous output index\n      parseInt(vout),\n      // the full previous output\n      {\n        script: address.toOutputScript(contractAddress),\n        value: ElementsValue.fromNumber(sats).bytes,\n        asset: AssetHash.fromHex(network.assetHash).bytes,\n        nonce: Buffer.alloc(0),\n      }\n    );\n\n    const recipient = prompt('Enter a recipient to send funds to');\n\n    const tx = await instance.functions\n      .sumMustBeThree(1, 2)\n      .withRecipient(recipient, sats - fee, network.assetHash)\n      .withFeeOutput(fee)\n      .unlock();\n\n    // extract and broadcast\n    txhex = tx.toHex();\n  };\n")),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"Add the ",(0,o.kt)("inlineCode",{parentName:"li"},"onClick")," to the ",(0,o.kt)("inlineCode",{parentName:"li"},"on:click")," Svelte directive of the button")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-html"},'<button class="button is-primary" on:click={onClick}> Sum must be 3 </button>\n')),(0,o.kt)("ol",{start:3},(0,o.kt)("li",{parentName:"ol"},"\ud83d\ude80 push the transaction")),(0,o.kt)("p",null,"Run the app and click on the button ",(0,o.kt)("inlineCode",{parentName:"p"},"Sum must be 3")),(0,o.kt)("p",null,"It will ask you to enter a transaction hash and vout and an recipient address."),(0,o.kt)("p",null,"Get a fresh unconfidential address"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"nigiri rpc --liquid validateaddress `nigiri rpc --liquid getnewaddress`\n")),(0,o.kt)("p",null,"Broadcast "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"nigiri push --liquid <txhex>\n")))}m.isMDXComponent=!0}}]);